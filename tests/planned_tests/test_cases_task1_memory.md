# 测试用例：任务一 - 记忆模块

## 1. 短期记忆测试

-   **用例1.1：对话历史记录**
    -   **前置条件**：用户与AI进行至少3轮对话。
    -   **操作**：检查会话中存储的对话历史队列。
    -   **预期结果**：队列中应包含最近3轮的对话内容，格式为 `[{"role": "user", ...}, {"role": "assistant", ...}]`。

-   **用例1.2：对话历史长度限制**
    -   **前置条件**：短期记忆队列长度设置为5，用户与AI进行7轮对话。
    -   **操作**：检查会G话中存储的对话历史队列。
    -   **预期结果**：队列中只包含最后5轮的对话，最早的2轮对话已被移除。

-   **用例1.3：新会话的空历史**
    -   **前置条件**：新用户或新会话开始。
    -   **操作**：在第一轮对话前检查对话历史队列。
    -   **预期结果**：队列为空。

## 2. 长期记忆测试

-   **用例2.1：创建长期记忆记录**
    -   **前置条件**：一个新用户完成首次对话，对话中包含可提取的关键信息（如“我最近在为考试焦虑”）。
    -   **操作**：触发用于更新长期记忆的函数。
    -   **预期结果**：数据库的 `LongTermMemory` 表中为该用户创建了一条新记录，`profile_summary` 或 `important_events` 字段包含了“为考试焦虑”等信息。

-   **用例2.2：更新长期记忆记录**
    -   **前置条件**：一个已有长期记忆记录的用户进行新的对话，并透露了新的重要信息（如“我找到了一份新工作”）。
    -   **操作**：触发用于更新长期记忆的函数。
    -   **预期结果**：数据库中对应用户的 `LongTermMemory` 记录被更新，`important_events` 字段追加了“找到新工作”的信息。

-   **用例2.3：数据格式正确性**
    -   **前置条件**：长期记忆数据已存入数据库。
    -   **操作**：直接查询数据库中的 `emotion_trends` 和 `important_events` 字段。
    -   **预期结果**：字段内容为有效的JSON格式。

## 3. 记忆调用集成测试

-   **用例3.1：短期记忆注入Prompt**
    -   **前置条件**：用户进行多轮对话。
    -   **操作**：在生成下一轮回复前，捕获传递给大语言模型的最终Prompt。
    -   **预期结果**：Prompt的开头部分包含了完整的短期记忆对话历史。

-   **用例3.2：长期记忆注入Prompt**
    -   **前置条件**：某用户的长期记忆中记录了“喜欢画画”。
    -   **操作**：用户开启新对话，说“我今天很无聊”。捕获传递给大语言模型的最终Prompt。
    -   **预期结果**：Prompt的上下文（Context）部分包含了“用户喜欢画画”的摘要信息。

-   **用例3.3：综合调用与回复生成**
    -   **前置条件**：用户的长期记忆中有“为考试焦虑”，短期对话历史中有“昨晚没睡好”。
    -   **操作**：用户输入“今天感觉压力好大”。
    -   **预期结果**：AI的回复能够结合这两个信息点，例如生成类似“感觉你还在为考试的事情担心呀，没睡好肯定会更累的。需要小狗陪你聊聊吗？”的个性化内容。
