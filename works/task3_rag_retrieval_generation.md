# 任务三：RAG检索与生成

## 1. 目标

实现一个完整的RAG工具，使其能够被Agent调用，根据用户问题从知识库中检索信息，并生成“小狗”风格的回复。

## 2. 详细步骤

### 2.1 RAG工具定义

-   **任务**: 创建一个新的工具文件，定义RAG的核心逻辑。
-   **实现**:
    1.  在 `tools` 目录下创建 `knowledge_base_search.py`。
    2.  定义一个名为 `search_knowledge_base` 的函数，它接收一个 `query` (用户问题)作为参数。

### 2.2 检索逻辑

-   **任务**: 在 `search_knowledge_base` 函数中实现从向量数据库检索相关信息的功能。
-   **实现**:
    1.  加载在任务二中创建的向量数据库。
    2.  加载同款的文本嵌入模型，将传入的 `query` 转换为向量。
    3.  使用查询向量在数据库中执行相似度搜索，获取最相关的N个文本块（例如N=3）。
    4.  将这N个文本块的内容拼接成一个字符串，作为背景知识返回。

### 2.3 Agent集成与Prompt设计

-   **任务**: 让Agent能够决策何时调用RAG工具，并将检索结果整合到最终的回复生成中。
-   **实现**:
    1.  在主Agent逻辑文件 (`agent.py` 或 `app.py`) 中，将 `search_knowledge_base` 工具注册到Agent可用的工具列表中。
    2.  修改Agent的系统Prompt，添加决策规则，指导它在检测到用户有明确求助意图时，调用 `search_knowledge_base` 工具。
    3.  设计一个新的Prompt模板，用于处理RAG工具的返回结果。该模板应包含以下指令：
        -   `你是一只叫“翻书小狗”的AI助手。`
        -   `请参考以下背景知识来回答用户的问题：{knowledge_context}`
        -   `请用“小狗翻书”的口吻来解释这些知识，语言要温暖、可爱、充满共情。`
        -   `不要直接复述知识，要用你自己的话进行转述。`

## 3. 验收标准

-   RAG工具能够根据查询返回相关的知识文本。
-   Agent能够在适当的时候（用户求助时）触发RAG工具。
-   Agent最终生成的回复能够结合检索到的知识，并保持“小狗”的独特风格。
